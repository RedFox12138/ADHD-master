<!-- pages/history/history.wxml -->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="title">📊 历史数据分析</view>
    <view class="subtitle">查看您的ADHD检测历史记录</view>
  </view>

  <!-- 日期选择 -->
  <view wx:if="{{!showChart}}" class="content-section">
    <!-- 日期列表 -->
    <view class="section-header">
      <view class="section-title">📅 选择日期</view>
      <view class="section-desc">点击日期查看当天的检测记录</view>
    </view>

    <view class="date-grid">
      <view wx:for="{{historyDates}}"
            wx:key="value"
            class="date-card {{selectedDate === item.value ? 'selected' : ''}}"
            bindtap="selectDate"
            data-date="{{item.value}}">
        <view class="date-icon">📅</view>
        <view class="date-text">{{item.text}}</view>
        <view class="date-badge" wx:if="{{item.count}}">{{item.count}}条记录</view>
      </view>
    </view>

    <!-- 文件列表 -->
    <view class="section-header" wx:if="{{selectedDate}}">
      <view class="section-title">📁 检测文件</view>
      <view class="section-desc">选择要查看的具体检测文件</view>
    </view>

    <view class="file-grid" wx:if="{{selectedDate && historyFiles.length}}">
      <scroll-view scroll-y class="file-scroll">
        <view wx:for="{{historyFiles}}"
              wx:key="name"
              class="file-card"
              bindtap="viewFile"
              data-file="{{item.fullName}}">
          <view class="file-icon">📄</view>
          <view class="file-info">
            <view class="file-name">{{item.name}}</view>
            <view class="file-time">{{item.time || '检测时间未知'}}</view>
            <view class="file-size">{{item.size || '大小未知'}}</view>
          </view>
          <view class="file-arrow">➤</view>
        </view>
      </scroll-view>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{selectedDate && !historyFiles.length}}">
      <view class="empty-icon">📭</view>
      <view class="empty-title">暂无检测记录</view>
      <view class="empty-desc">该日期下没有找到检测文件</view>
    </view>
  </view>

  <!-- 图表视图 -->
  <view class="chart-section" wx:if="{{showChart}}">
    <view class="chart-header">
      <view class="chart-title">📈 数据可视化</view>
      <button class="back-btn" bindtap="backToList">← 返回列表</button>
    </view>

    <view class="chart-container">
      <canvas canvas-id="historyChart" class="chart-canvas"></canvas>
    </view>

    <view class="chart-controls">
      <button class="control-btn export" bindtap="exportData">📤 导出数据</button>
      <button class="control-btn share" bindtap="shareChart">📱 分享图表</button>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <view class="loading-text">正在加载数据...</view>
  </view>
</view>